<div class="toolbar-precios">
  <div class="filtros-izquierda">
    <input type="text" placeholder="Buscar por código o descripción..." [(ngModel)]="terminoBusqueda"
      (input)="aplicarFiltros()" />

    <input type="number" placeholder="Venta mín" [(ngModel)]="filtroMinVenta" (change)="aplicarFiltros()" />

    <input type="number" placeholder="Venta máx" [(ngModel)]="filtroMaxVenta" (change)="aplicarFiltros()" />
  </div>

  <div class="acciones-derecha">
    <div class="porcentaje-global">
      <input type="number" placeholder="% global" [(ngModel)]="porcentajeGlobal" />
      <button mat-raised-button color="primary" (click)="aplicarPorcentajeGlobal()">
        Aplicar % a listas
      </button>
    </div>

    <button mat-stroked-button color="primary" (click)="exportarAExcel()">
      Exportar Excel
    </button>
  </div>
</div>

<table mat-table [dataSource]="itemsPagina" class="tabla-precios mat-elevation-z2">

  <!-- CÓDIGO -->
  <ng-container matColumnDef="codigo">
    <th mat-header-cell *matHeaderCellDef (click)="ordenar('codigo')" class="sortable">
      CÓDIGO
    </th>
    <td mat-cell *matCellDef="let item"> {{ item.codigo }} </td>
  </ng-container>

  <!-- DESCRIPCIÓN -->
  <ng-container matColumnDef="descripcion">
    <th mat-header-cell *matHeaderCellDef (click)="ordenar('descripcion')" class="sortable">
      DESCRIPCIÓN
    </th>
    <td mat-cell *matCellDef="let item"> {{ item.descripcion }} </td>
  </ng-container>

  <!-- PRECIO VENTA -->
  <ng-container matColumnDef="precioVenta">
    <th mat-header-cell *matHeaderCellDef (click)="ordenar('precioVenta')" class="sortable">
      VENTA
    </th>
    <td mat-cell *matCellDef="let item">
      <input type="number" [(ngModel)]="item.precioVenta" (change)="onPrecioVentaChange(item)" class="input-precio" />
    </td>
  </ng-container>

  <!-- PRECIO COSTO -->
  <ng-container matColumnDef="precioCosto">
    <th mat-header-cell *matHeaderCellDef (click)="ordenar('precioCosto')" class="sortable">
      COSTO
    </th>
    <td mat-cell *matCellDef="let item">
      <input type="number" [(ngModel)]="item.precioCosto" (change)="onPrecioCostoChange(item)" class="input-precio" />
    </td>
  </ng-container>

  <!-- LISTAS DINÁMICAS -->
  @for (lista of listas; track lista.key; let i = $index) {

  <!-- PORCENTAJE -->
  <ng-container [matColumnDef]="lista.key + '_pct'">
    <th mat-header-cell *matHeaderCellDef>
      % {{ lista.nombre }}
    </th>
    <td mat-cell *matCellDef="let item">
      <input type="number" [(ngModel)]="item.listasDetalle[i].porcentaje"
        (change)="onPorcentajeChange(item, item.listasDetalle[i])" class="input-porcentaje" />
    </td>
  </ng-container>

  <!-- PRECIO -->
  <ng-container [matColumnDef]="lista.key + '_val'">
    <th mat-header-cell *matHeaderCellDef>
      {{ lista.nombre }}
    </th>
    <td mat-cell *matCellDef="let item">
      {{ item.listasDetalle[i].precio }}
    </td>
  </ng-container>
  }

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>

  <tr mat-row *matRowDef="let row; columns: displayedColumns;" [class.highlight]="row._highlight">
  </tr>
</table>

<div class="paginacion">
  <button mat-stroked-button (click)="paginaAnterior()" [disabled]="pageIndex === 0">
    Anterior
  </button>

  <span>
    Página {{ pageIndex + 1 }} de {{ totalPaginas }}
    ({{ itemsFiltrados.length }} ítems)
  </span>

  <button mat-stroked-button (click)="paginaSiguiente()" [disabled]="pageIndex + 1 >= totalPaginas">
    Siguiente
  </button>

  <span class="page-size">
    Mostrar
    <select [(ngModel)]="pageSize" (change)="cambiarPageSize()">
      <option [ngValue]="5">5</option>
      <option [ngValue]="10">10</option>
      <option [ngValue]="25">25</option>
      <option [ngValue]="50">50</option>
    </select>
    por página
  </span>
</div>