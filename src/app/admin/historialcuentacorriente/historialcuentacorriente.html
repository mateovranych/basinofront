<div class="historial-page">

  <div class="header-section">
    <h2>Resumen Cuenta Corriente</h2>
    <div class="actions">
      <button mat-raised-button color="primary" (click)="verHistorial()" [disabled]="!dataSource.data.length">
        <mat-icon>picture_as_pdf</mat-icon>
        Imprimir
      </button>
    </div>
  </div>

  <hr>

  <div class="filtros-grid">

    <mat-form-field appearance="outline" class="cliente-select">
      <mat-label>Cliente</mat-label>
      <mat-select [formControl]="clienteIdCtrl">
        <mat-option>
          <ngx-mat-select-search [formControl]="filtroClientesCtrl" placeholderLabel="Buscar cliente..."
            noEntriesFoundLabel="Sin resultados">
          </ngx-mat-select-search>
        </mat-option>
        <mat-option *ngFor="let c of clientesFiltrados" [value]="c.id">
          {{ c.razonSocial }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Desde</mat-label>
      <input matInput [matDatepicker]="pickerDesde" [formControl]="fechaDesde">
      <mat-datepicker-toggle matIconSuffix [for]="pickerDesde"></mat-datepicker-toggle>
      <mat-datepicker #pickerDesde></mat-datepicker>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Hasta</mat-label>
      <input matInput [matDatepicker]="pickerHasta" [formControl]="fechaHasta">
      <mat-datepicker-toggle matIconSuffix [for]="pickerHasta"></mat-datepicker-toggle>
      <mat-datepicker #pickerHasta></mat-datepicker>
    </mat-form-field>

    <button mat-icon-button color="warn" matTooltip="Limpiar filtros" (click)="fechaDesde.reset(); fechaHasta.reset()">
      <mat-icon>filter_list_off</mat-icon>
    </button>
  </div>

  <div class="mat-elevation-z8 table-container" *ngIf="dataSource.data.length; else sinDatos">

    <table mat-table [dataSource]="dataSource">

      <ng-container matColumnDef="fecha">
        <th mat-header-cell *matHeaderCellDef> Fecha </th>
        <td mat-cell *matCellDef="let m">
          {{ m.fecha | date:'dd/MM/yyyy HH:mm' }}
        </td>
      </ng-container>

      <ng-container matColumnDef="concepto">
        <th mat-header-cell *matHeaderCellDef> Concepto </th>
        <td mat-cell *matCellDef="let m">
          {{ m.concepto }}
        </td>
      </ng-container>

      <ng-container matColumnDef="debe">
        <th mat-header-cell *matHeaderCellDef class="num"> Debe </th>
        <td mat-cell *matCellDef="let m" class="num debe">
          {{ m.debe | currency }}
        </td>
      </ng-container>

      <ng-container matColumnDef="haber">
        <th mat-header-cell *matHeaderCellDef class="num"> Haber </th>
        <td mat-cell *matCellDef="let m" class="num haber">
          {{ m.haber | currency }}
        </td>
      </ng-container>

      <ng-container matColumnDef="saldo">
        <th mat-header-cell *matHeaderCellDef class="num"> Saldo </th>
        <td mat-cell *matCellDef="let m" class="num" [ngClass]="{'deuda': m.saldo > 0, 'favor': m.saldo < 0}">
          {{ m.saldo | currency }}
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="['fecha','concepto','debe','haber','saldo']"></tr>
      <tr mat-row *matRowDef="let row; columns: ['fecha','concepto','debe','haber','saldo'];">
      </tr>

    </table>

    <mat-paginator [pageSizeOptions]="[10, 15, 25, 50]" [pageSize]="50" showFirstLastButtons>
    </mat-paginator>
  </div>

  <ng-template #sinDatos>
    <div class="no-data-msg">
      <p *ngIf="!cargando && clienteIdCtrl.value">
        No se encontraron movimientos para los criterios seleccionados.
      </p>
      <p *ngIf="!clienteIdCtrl.value">
        Por favor, seleccione un cliente para consultar el historial.
      </p>
      <mat-spinner *ngIf="cargando" diameter="40"></mat-spinner>
    </div>
  </ng-template>

</div>